name: Build PCF Solution

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v4

    - name: Setup Node
      uses: actions/setup-node@v4
      with:
        node-version: 18

    - name: Install dependencies
      run: npm install

    - name: Build PCF
      run: npm run build

    # ✅ Create solution (ถูกต้อง)
    - name: Create solution
      uses: microsoft/powerplatform-actions/create-solution@v1
      with:
        solution-name: OptionsetPCF
        publisher-name: Default
        publisher-prefix: def

    # Copy PCF into solution
    - name: Copy PCF to solution
      run: |
        mkdir OptionsetPCF/src/Controls
        xcopy . OptionsetPCF/src/Controls/OptionsetPCF /E /I /Y

    # Pack solution
    - name: Pack solution
      uses: microsoft/powerplatform-actions/pack-solution@v1
      with:
        solution-folder: OptionsetPCF
        solution-file: OptionsetPCF.zip
        solution-type: Unmanaged

    - name: Upload artifact
      uses: actions/upload-artifact@v4
      with:
        name: OptionsetPCF-Solution
        path: OptionsetPCF.zip
