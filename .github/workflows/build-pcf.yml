name: Build PCF Solution

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v4

    - name: Setup Node
      uses: actions/setup-node@v4
      with:
        node-version: 18

    - name: Install dependencies
      run: npm install

    - name: Build PCF
      run: npm run build

    # ðŸ‘‰ Init solution
    - name: Init solution
      uses: microsoft/powerplatform-actions/init-solution@v1
      with:
        solution-name: OptionsetPCF
        publisher-name: Default
        publisher-prefix: def

    # ðŸ‘‰ Copy PCF into solution
    - name: Copy PCF to solution
      run: |
        mkdir OptionsetPCF/src/Controls
        xcopy . OptionsetPCF/src/Controls/OptionsetPCF /E /I /Y

    # ðŸ‘‰ Add PCF reference
    - name: Add PCF reference
      uses: microsoft/powerplatform-actions/add-solution-component@v1
      with:
        component-type: pcf
        component-path: OptionsetPCF/src/Controls/OptionsetPCF

    # ðŸ‘‰ Pack solution
    - name: Pack solution
      uses: microsoft/powerplatform-actions/pack-solution@v1
      with:
        solution-folder: OptionsetPCF
        solution-file: OptionsetPCF.zip
        solution-type: Unmanaged

    - name: Upload artifact
      uses: actions/upload-artifact@v4
      with:
        name: OptionsetPCF-Solution
        path: OptionsetPCF.zip
